---
author: SouthFox
title: ä¸ºåšå®¢æ”¯æŒè¯„è®ºç³»ç»Ÿ
date: 2022-01-31 11:31:57
tags: 
- æŠ€æœ¯
- å»ºç«™
category: æŠ€æœ¯
toc: true
---

çªç„¶å‘ç°åŠ å…¥åå¹´ä¹‹çº¦çš„åšå®¢è¯„è®ºåŒºéƒ½å¥½çƒ­é—¹â€¦â€¦ä¼¼ä¹éƒ½æ˜¯éšæœºè®¿é—®è¿‡æ¥çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰å¿…è¦ä¸ºåšå®¢åŠ ä¸Šè¯„è®ºç³»ç»Ÿçš„ï¼Ÿ

<!--more-->

è€ƒå¯Ÿäº†ä¸€ç•ªé€‰æ‹©äº†ä¾é  `GitHub Discussions` çš„ `Giscus` åšä¸ºåšå®¢çš„è¯„è®ºç³»ç»Ÿã€‚

## ç‰¹ç‚¹

ğŸ‘ ä¼˜ç‚¹ï¼š

- æ¯”èµ· `Gitalk` ï¼Œæ‹¥æœ‰æ›´å°çš„æƒé™è¯·æ±‚
- éƒ¨ç½²ä¹Ÿæ–¹ä¾¿ï¼Œååˆ†é’Ÿå†…éƒ½èƒ½è½»æ¾æå®š
- æ•°æ®å®‰å…¨ä¹Ÿæœ‰ `GitHub` åšèƒŒä¹¦ï¼Œè‡³å°‘æ¯”è‡ªå»ºå¼º
- æ‹‰å– `Discussions` æ•°æ®çš„è„šæœ¬æ˜¯æ”¾åœ¨ `vercel` ä¸Šï¼Œå›½å†…çœ‹è¯„è®ºè‡³å°‘æ˜¯æ²¡é—®é¢˜çš„

ğŸ™ƒ ç¼ºç‚¹ï¼š

- è¯„è®ºå¾—éœ€è¦ä¸ª `GitHub` å¸å·ï¼Œå¯¹äºæ²¡æœ‰ç›¸å…³ç»éªŒçš„äººçœŸå¯è°“å¹æ¯ä¹‹å¢™äº†ï¼Œä½†æ˜¯ä¹Ÿä¸å…¨æ˜¯åäº‹ï¼Œå€’åƒåœ¾è¯„è®ºä¹Ÿèƒ½éš”ç»æ‰å¤§éƒ¨åˆ†ã€‚



## éƒ¨ç½²

0. ä¸ºä»“åº“å¼€å¯ `Discussions` ï¼Œä»“åº“ Setting --> Features --> å‹¾é€‰ Discussions ã€‚
1. å…ˆå» [GitHub åº”ç”¨é¡µ](https://github.com/apps/giscus) å®‰è£… `Giscus` ï¼Œå¯ä»¥ä»…ç»™æŒ‡å®šçš„ä»“åº“æˆæƒã€‚
2. åœ¨åˆ° [Giscus å®˜ç½‘](https://giscus.app/zh-CN) è¿›è¡Œé…ç½®ï¼Œè¾“å…¥ä»“åº“åï¼Œå†³å®šæ˜ å°„æ–¹å¼ç­‰ã€è¯„è®ºæ ·å¼ç­‰ã€‚
3. æœ€åç”Ÿæˆä¸€ä¸ªè„šæœ¬ä»£ç ï¼ŒåµŒå…¥åˆ°åšå®¢æ–‡ç« æ¨¡æ¿åº•éƒ¨ï¼Œæå®šï¼



## å‘

å¦‚æœæ˜ å°„æ–¹å¼é€‰æ‹© `pathname`ï¼Œè€Œ uri é‡ŒåŒ…å«ä¸­æ–‡ï¼Œå°†ä¼šè¢«è§£ç ï¼Œæå¾—éå¸¸ä¹±ã€‚æ‰€ä»¥å¯ä»¥è‡ªå·±éº»çƒ¦ä¸€ç‚¹ï¼Œæ‰‹åŠ¨æŒ‡å®šã€‚

å¦‚ `Hexo` ï¼Œåœ¨ `head` æ¨¡æ¿ä¸­æ’å…¥åˆ° `<head>` æ ‡ç­¾é‡Œï¼š

```ejs
<% if (page.title){ %><meta property="og:title" content="<%= page.path %>"/><% } %>
```

ä¹‹å `Giscus` é€‰æ‹©ä¸º `og:title` ï¼Œè¿™æ ·å°±ç¡®ä¿æ ‡é¢˜ä¸ä¼šè¢«è½¬ç äº†ã€‚



## è‡ªåŠ¨åˆå§‹åŒ–

æ€»ä½“æ¥è¯´è¿˜æ˜¯ä¸é”™çš„ï¼Œå†æŠ˜è…¾ä¸€ä¸‹å¯ä»¥é€‰æ‹©è‡ªå»ºï¼Œè¿™æ ·å¯ä»¥é¿å¼€å¯¹è„šæœ¬æ‰€åœ¨åŸŸåçš„å°é”ï¼Œæˆ–è€…éƒ¨ç½²æ—¶è‡ªåŠ¨åˆ›å»ºå¯¹åº”å¸–å­ï¼Œ<del>ä¸è¿‡æŒºéº»çƒ¦ï¼Œä»¥ååœ¨æ‘¸å§ ğŸŸ ã€‚</del>del>

**3-13 æ›´æ–°ï¼š**

å…¶å®å¾ˆæ—©å°±æ‘¸äº†ï¼Œåªæ˜¯æˆ‘æ†‹ç€ä¸æ”¾è€Œå·²ï¼ˆ

```python
import sys
import os
import requests
import json
import getopt
import re
import random
from datetime import datetime



def addDiscussion():
    currentYear = str(datetime.now().year)
    repo_id="aaabbb"
    category_id="cccddd"
    DISCUSSIONS_TOKEN=os.environ.get('DISCUSSIONS_TOKEN') #æ ¹æ®è‡ªå·±å®é™…æƒ…å†µé€‰æ‹©

    header = {
        "Authorization": f"Bearer {DISCUSSIONS_TOKEN}"
    }
    data = {
        'query': """query{repository(owner:"name",name:"repo_name"){
                id discussions(first:100, categoryId: "aaabbb"){
                    nodes{
                        title
                    }
                }
            }
        }"""
    }
    url = 'https://api.github.com/graphql'

    r = requests.post(url, headers=header, data=json.dumps(data))
    if r.status_code == 200:
        discussions = r.json()

    discussions = discussions["data"]["repository"]["discussions"]["nodes"]

    discu_list = []
    for i in discussions:
        discu_list.append(i["title"])

    for post in postlist:
        if currentYear not in post:
            continue

        if post not in discu_list:
            data = {
            'query': """mutation{
            createDiscussion(input: {repositoryId: "%s", categoryId: "%s", body: "%s", title: "%s"}) {
                discussion {
                    id
                        }
                    }
                }""" % (repo_id, category_id, 'blog url' + post, post)
            }

            r = requests.post(url, headers=header, data=json.dumps(data))
            if r.status_code == 200:
                print(f"åˆå§‹åŒ–å¯¹åº”è®¨è®ºï¼ {post}")
                print(r.text)

if __name__ == '__main__':
    filelist = []
    postlist = []
    addDiscussion()
```

å­¦äº†ä¸€ä¸‹æ–°ç©æ„â€¦â€¦ `graphql` ä¼¼ä¹æ¯”åŸºäº `http` å½¢å¼çš„æ›´å¼ºå¤§ä¸€ç‚¹ï¼Ÿ

å…¶ä¸­æ˜¯æ ¹æ®å¯¹åº”çš„ `access token` è¿›è¡Œéƒ¨ç½²ï¼Œæ‰€ä»¥è¦ä¸ºå¯¹åº”éƒ¨ç½²çš„ `access token` æŒ‡å®š `discussions` æƒé™â€¦â€¦

æ³¨æ„å…¶ä¸­çš„ `currentYear` é‚£é‡Œï¼Œå› ä¸ºåªè·å–äº†æœ€æ–°çš„ `100` æ¡æ•°æ®ï¼Œè¦æ˜¯æ–‡ç« æ•°æ®è¶…è¿‡ `100` æ¡çš„è¯æˆ–è®¸ä¼šé‡å¤åˆ›å»ºï¼Ÿæ‰€ä»¥å°±ä»…ä»…åªåˆ¤æ–­å½“å¹´çš„æ–‡ç« äº†ï¼Œç¬¬ä¸€æ¬¡éƒ¨ç½²æ—¶è¯·å»æ‰æ­¤åˆ¤æ–­ã€‚é™¤éä½ æƒ³å½“è¶…æ—¶ç©ºæˆ˜å£«ä¸ºä»¥å¾€å¹´ä»½å†™æ–‡ç« æˆ–è€…æ˜¯ä¸€å¹´èƒ½å†™ `100` ç¯‡æ–‡ç« çš„äººï¼Œé‚£ä¹ˆæ­¤é€»è¾‘åº”è¯¥æ²¡é—®é¢˜â€¦â€¦å§ã€‚

æ˜¯ä¸ºäº† `GitHub Actions` å‡†å¤‡çš„ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆçš„è¯å¯ä»¥çœ‹[è¿™](../../03/Github-Actions-æµ…å°è¾„æ­¢)ã€‚



## æœ€å

æœ€åï¼Œæ¬¢è¿ä½ èƒ½è®¿é—®åˆ°æˆ‘è¿™è’å²›ï¼Œè¯·å‹å–„è¯„è®ºå“¦~



