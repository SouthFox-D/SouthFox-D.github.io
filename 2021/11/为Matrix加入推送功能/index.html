<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><meta property="og:title" content="为 Matrix 加入自定义推送功能 — 狐狸反走矣" /><meta property="og:site_name" content="狐狸反走矣" /><meta property="og:image" content="https://blog.southfox.me/favicon.png" /><meta name="fediverse:creator" content="SouthFox@foxsay.southfox.me" /><title>为 Matrix 加入自定义推送功能 — 狐狸反走矣</title><link rel="stylesheet" href="/assets/css/main.css" /><link rel="alternative" href="/rss2.xml" title="狐狸反走矣" type="application/atom+xml" /></head><body><nav class="nav"><a href="/" class="brand"><span>狐狸反走矣</span></a><input id="bmenub" type="checkbox" class="show" aria-label="open menu" /><label for="bmenub" class="burger pseudo button">☰</label><div class="menu"><a href="/archives/">归档</a><a href="/tags/">标签</a><a href="/search/">搜索</a><a href="/about/">关于</a></div></nav><div class="container flex"><div class="content"><main data-pagefind-body="true"><div><h2>为 Matrix 加入自定义推送功能</h2><h3>by SouthFox</h3><h3 data-pagefind-sort="date">2021-11-22</h3><div><p><code>Matrix</code> 是一个开源的聊天协议，和 <code>XMPP</code> 一样的联邦制设计也保证了像电子邮件一样的通信便捷。</p><span id="more"></span><p>好的地方很多，但最明显坏处就是推送了，对于即时通信来说，没有推送是非常大的不便……虽然搭建 <code>Matrix</code> 的应用 <code>Synapse</code> 配置文件启用邮箱的话可以启用邮件通知，不过鉴于邮件时效性也不是很高，所以需要个其他的推送手段。（谷歌市场下的 <code>Element</code> 附带了谷歌的消息推送，不过很遗憾在国内处于残废状态。）</p><p>所幸 <code>Synapse</code> 自带的 <a href="https://spec.matrix.org/v1.1/client-server-api/" class="external_link">API</a> 可以定义推送规则，定义后帐号收到消息，服务器就可以将消息以 <code>JSON</code> 的形式推送到自定义的地址，来个曲线救国。</p><h1 id="Gotify">Gotify</h1><p>推送用到的工具为 <code>Gotify</code> ，特点是使用 <code>GO</code> 编写，高效快速，不过缺点就是安卓得常驻后台接收推送，不过至少要比腾讯全家桶吃的电要少。</p><h2 id="下载">下载</h2><p>去 <a href="https://github.com/gotify/server/releases" class="external_link">Releases</a>处找到对应版本的下载链接，解压到<code>/opt/gotify/</code>。</p><pre><code>unzip gotify-file -d /opt/gotify/</code></pre><p>然后下载配置样板。</p><pre><code>mkdir /etc/gotify
wget -O /etc/gotify/config.yml https://raw.githubusercontent.com/gotify/server/master/config.example.yml</code></pre><p>编辑 <code>/etc/gotify/config.yml</code>。将 <code>port</code> 改为没有占用的端口， <code>name</code> 和 <code>pass</code> 是管理员的用户名和密码。</p><h1 id="Nginx反代">Nginx 反代</h1><p>在 <code>nginx</code> 的新建一个虚拟主机并在配置文件增加以下内容：</p><pre><code>location / {
  proxy_pass         http://localhost:8080;
  rewrite ^/gotify(/.*) $1 break;
  proxy_http_version 1.1;

  # Ensuring it can use websockets
  proxy_set_header   Upgrade $http_upgrade;
  proxy_set_header   Connection &quot;upgrade&quot;;
  proxy_set_header   X-Real-IP $remote_addr;
  proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header   X-Forwarded-Proto http;
  proxy_redirect     http:// $scheme://;
}</code></pre><blockquote><p>proxy_set_header   Connection &quot;upgrade&quot;; 这一栏不要漏了……要不然开启 WS 时会报错……</p></blockquote><h1 id="设置服务">设置服务</h1><p>新建并编辑 <code>/etc/systemd/system/gotify.service</code>。</p><pre><code>[Unit]
Description=gotify service
After=network.target
Wants=network.target

[Service]
Type=simple
PIDFile=/run/gotify.pid
WorkingDirectory=/opt/gotify
ExecStart=/opt/gotify/gotify-file
RestartPreventExitStatus=23
Restart=always
RestartSec=10s

[Install]
WantedBy=multi-user.target</code></pre><p>然后开启服务并设置成开机启动。</p><pre><code>systemctl start gotify
systemctl enable gotify</code></pre><p>没有报错的话就可以打开 <code>Nginx</code> 里所设置的域名进入管理页面了，（改密码）之后就可以新建应用了，拿到推送令牌，就可以向服务器设置推送规则了。</p><h2 id="设置推送">设置推送</h2><p>在官方文档里，通过 /_matrix/client/v3/pushers/set <code>API</code> 就可以设置推送规则了，通过 <code>curl</code> ，或者其他方式向服务器对应地址发送 <code>POST</code> 请求即可使用。</p><pre><code>curl 'https://server_url/_matrix/client/r0/pushers/set' -H 'Authorization: Bearer access_token' -H 'Content-Type: application/json' -X POST -d '{&quot;lang&quot;: &quot;en&quot;,&quot;kind&quot;: &quot;http&quot;,&quot;app_display_name&quot;: &quot;Gotify&quot;,&quot;device_display_name&quot;: &quot;Gotify&quot;,&quot;pushkey&quot;: &quot;Gotify-PushKey&quot;,&quot;app_id&quot;: &quot;zh.xxx.gotify&quot;,&quot;data&quot;: {&quot;url&quot;: &quot;https://Push_url/_matrix/push/v1/notify&quot;,&quot;format&quot;: &quot;full_event&quot;}}'</code></pre><p>详细说明请查阅官方 <a href="https://spec.matrix.org/v1.1/client-server-api/#post_matrixclientv3pushersset" class="external_link">文档</a> , 其中 <code>access_token</code> 可以在应用里拿到，<code>pushkey</code> 设置成 <code>Gotify-PushKey</code> 的样子是为了后续处理方便……现阶段推送地址必须包含 <code>/_matrix/push/v1/notify</code> 路径，否则会报错，所以不得不进行额外处理了……</p><h2 id="接收推送">接收推送</h2><p>服务器设置推送规则之后就会向对应地址发送数据了，因为推送地址现阶段必须包含 <code>/_matrix/push/v1/notify</code> 路径，所以不得不再设置一个接收服务然后进行处理了。</p><p>接下来使用 <code>python</code> 的 <code>flask</code> 框架简单搭一个服务，首先先安装环境。</p><pre><code><span class="syntax-symbol">pip3</span> <span class="syntax-symbol">install</span> <span class="syntax-symbol">flask</span>
<span class="syntax-symbol">pip3</span> <span class="syntax-symbol">install</span> <span class="syntax-symbol">flask</span><span class="syntax-operator">-</span><span class="syntax-symbol">apscheduler</span></code></pre><p>然后是代码：</p><pre><code><span class="syntax-special">import</span> <span class="syntax-symbol">json</span>
<span class="syntax-special">import</span> <span class="syntax-symbol">requests</span>
<span class="syntax-special">import</span> <span class="syntax-symbol">datetime</span>

<span class="syntax-special">from</span> <span class="syntax-symbol">flask</span> <span class="syntax-special">import</span> <span class="syntax-symbol">Flask</span><span class="syntax-operator">,</span> <span class="syntax-symbol">jsonify</span><span class="syntax-operator">,</span> <span class="syntax-symbol">request</span>
<span class="syntax-special">from</span> <span class="syntax-symbol">flask_apscheduler</span> <span class="syntax-special">import</span> <span class="syntax-symbol">APScheduler</span>
<span class="syntax-symbol">app</span> <span class="syntax-operator">=</span> <span class="syntax-symbol">Flask</span><span class="syntax-open">(</span><span class="syntax-symbol">__name__</span><span class="syntax-close">)</span>
<span class="syntax-symbol">scheduler</span> <span class="syntax-operator">=</span> <span class="syntax-symbol">APScheduler</span><span class="syntax-open">(</span><span class="syntax-close">)</span>

<span class="syntax-symbol">scheduler</span><span class="syntax-operator">.</span><span class="syntax-symbol">start</span><span class="syntax-open">(</span><span class="syntax-close">)</span>

<span class="syntax-special">def</span> <span class="syntax-symbol">push_notification</span><span class="syntax-open">(</span><span class="syntax-symbol">push_data</span><span class="syntax-close">)</span><span class="syntax-operator">:</span>
    <span class="syntax-special">if</span> <span class="syntax-symbol">push_data</span><span class="syntax-open">[</span><span class="syntax-string">&quot;push_way&quot;</span><span class="syntax-close">]</span> <span class="syntax-operator">==</span> <span class="syntax-string">'Gotify'</span><span class="syntax-operator">:</span>
        <span class="syntax-symbol">resp</span> <span class="syntax-operator">=</span> <span class="syntax-symbol">requests</span><span class="syntax-operator">.</span><span class="syntax-symbol">post</span><span class="syntax-open">(</span><span class="syntax-symbol">f</span><span class="syntax-string">'https://push.xxx.xxx/message?token={push_data[&quot;push_token&quot;]}'</span><span class="syntax-operator">,</span> <span class="syntax-symbol">json</span><span class="syntax-operator">=</span><span class="syntax-open">{</span>
        <span class="syntax-string">&quot;message&quot;</span><span class="syntax-operator">:</span> <span class="syntax-symbol">f</span><span class="syntax-string">'「{push_data[&quot;sender&quot;]}」发送了消息给你。'</span><span class="syntax-operator">,</span>
        <span class="syntax-string">&quot;priority&quot;</span><span class="syntax-operator">:</span> <span class="syntax-symbol">8</span><span class="syntax-operator">,</span>
        <span class="syntax-string">&quot;title&quot;</span><span class="syntax-operator">:</span> <span class="syntax-string">&quot;新消息！&quot;</span>
        <span class="syntax-close">}</span><span class="syntax-close">)</span>
        <span class="syntax-keyword">print</span><span class="syntax-open">(</span><span class="syntax-symbol">resp</span><span class="syntax-close">)</span>
        <span class="syntax-special">return</span>
    <span class="syntax-special">if</span> <span class="syntax-symbol">push_data</span><span class="syntax-open">[</span><span class="syntax-string">&quot;push_way&quot;</span><span class="syntax-close">]</span> <span class="syntax-operator">==</span> <span class="syntax-string">'Bary'</span><span class="syntax-operator">:</span>
        <span class="syntax-special">try</span><span class="syntax-operator">:</span>
            <span class="syntax-symbol">response</span> <span class="syntax-operator">=</span> <span class="syntax-symbol">requests</span><span class="syntax-operator">.</span><span class="syntax-symbol">post</span><span class="syntax-open">(</span>
                <span class="syntax-symbol">url</span><span class="syntax-operator">=</span><span class="syntax-string">&quot;https://api.day.app/push&quot;</span><span class="syntax-operator">,</span>
                <span class="syntax-symbol">headers</span><span class="syntax-operator">=</span><span class="syntax-open">{</span>
                    <span class="syntax-string">&quot;Content-Type&quot;</span><span class="syntax-operator">:</span> <span class="syntax-string">&quot;application/json; charset=utf-8&quot;</span><span class="syntax-operator">,</span>
                <span class="syntax-close">}</span><span class="syntax-operator">,</span>
                <span class="syntax-symbol">data</span><span class="syntax-operator">=</span><span class="syntax-symbol">json</span><span class="syntax-operator">.</span><span class="syntax-symbol">dumps</span><span class="syntax-open">(</span><span class="syntax-open">{</span>
                    <span class="syntax-string">&quot;body&quot;</span><span class="syntax-operator">:</span> <span class="syntax-symbol">f</span><span class="syntax-string">'「{push_data[&quot;sender&quot;]}」发送了消息给你。'</span><span class="syntax-operator">,</span>
                    <span class="syntax-string">&quot;device_key&quot;</span><span class="syntax-operator">:</span> <span class="syntax-symbol">push_data</span><span class="syntax-open">[</span><span class="syntax-string">&quot;push_token&quot;</span><span class="syntax-close">]</span><span class="syntax-operator">,</span>
                    <span class="syntax-string">&quot;title&quot;</span><span class="syntax-operator">:</span> <span class="syntax-string">&quot;新消息！&quot;</span><span class="syntax-operator">,</span>
                    <span class="syntax-string">&quot;category&quot;</span><span class="syntax-operator">:</span> <span class="syntax-string">&quot;category&quot;</span><span class="syntax-operator">,</span>
                    <span class="syntax-string">&quot;sound&quot;</span><span class="syntax-operator">:</span> <span class="syntax-string">&quot;minuet.caf&quot;</span><span class="syntax-operator">,</span>
                <span class="syntax-close">}</span><span class="syntax-close">)</span>
            <span class="syntax-close">)</span>
            <span class="syntax-keyword">print</span><span class="syntax-open">(</span><span class="syntax-string">'Response HTTP Status Code: {status_code}'</span><span class="syntax-operator">.</span><span class="syntax-keyword">format</span><span class="syntax-open">(</span>
                <span class="syntax-symbol">status_code</span><span class="syntax-operator">=</span><span class="syntax-symbol">response</span><span class="syntax-operator">.</span><span class="syntax-symbol">status_code</span><span class="syntax-close">)</span><span class="syntax-close">)</span>
            <span class="syntax-keyword">print</span><span class="syntax-open">(</span><span class="syntax-string">'Response HTTP Response Body: {content}'</span><span class="syntax-operator">.</span><span class="syntax-keyword">format</span><span class="syntax-open">(</span>
                <span class="syntax-symbol">content</span><span class="syntax-operator">=</span><span class="syntax-symbol">response</span><span class="syntax-operator">.</span><span class="syntax-symbol">content</span><span class="syntax-close">)</span><span class="syntax-close">)</span>
        <span class="syntax-special">except</span> <span class="syntax-symbol">requests</span><span class="syntax-operator">.</span><span class="syntax-symbol">exceptions</span><span class="syntax-operator">.</span><span class="syntax-symbol">RequestException</span><span class="syntax-operator">:</span>
            <span class="syntax-keyword">print</span><span class="syntax-open">(</span><span class="syntax-string">'HTTP Request failed'</span><span class="syntax-close">)</span>
        <span class="syntax-special">return</span>


<span class="syntax-comment"># Our route that will receive the webhooks from Duffel's servers
</span><span class="syntax-operator">@</span><span class="syntax-symbol">app</span><span class="syntax-operator">.</span><span class="syntax-symbol">route</span><span class="syntax-open">(</span><span class="syntax-string">'/_matrix/push/v1/notify'</span><span class="syntax-operator">,</span> <span class="syntax-symbol">methods</span><span class="syntax-operator">=</span><span class="syntax-open">[</span><span class="syntax-string">'POST'</span><span class="syntax-close">]</span><span class="syntax-close">)</span>
<span class="syntax-special">def</span> <span class="syntax-symbol">hello_world</span><span class="syntax-open">(</span><span class="syntax-close">)</span><span class="syntax-operator">:</span>
    <span class="syntax-symbol">push_data</span> <span class="syntax-operator">=</span> <span class="syntax-open">{</span><span class="syntax-close">}</span>
    <span class="syntax-symbol">event</span> <span class="syntax-operator">=</span> <span class="syntax-special">None</span>

    <span class="syntax-special">try</span><span class="syntax-operator">:</span>
        <span class="syntax-symbol">event</span> <span class="syntax-operator">=</span> <span class="syntax-symbol">request</span><span class="syntax-operator">.</span><span class="syntax-symbol">json</span>
        <span class="syntax-keyword">print</span><span class="syntax-open">(</span><span class="syntax-symbol">event</span><span class="syntax-close">)</span>

    <span class="syntax-special">except</span><span class="syntax-operator">:</span>
        <span class="syntax-special">return</span> <span class="syntax-symbol">jsonify</span><span class="syntax-open">(</span><span class="syntax-symbol">success</span><span class="syntax-operator">=</span><span class="syntax-special">False</span><span class="syntax-close">)</span>

    <span class="syntax-comment"># Handle the event
</span>    <span class="syntax-special">if</span> <span class="syntax-symbol">event</span><span class="syntax-open">[</span><span class="syntax-string">&quot;notification&quot;</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-string">&quot;type&quot;</span><span class="syntax-close">]</span> <span class="syntax-operator">==</span> <span class="syntax-string">'m.room.message'</span> <span class="syntax-special">or</span> <span class="syntax-symbol">event</span><span class="syntax-open">[</span><span class="syntax-string">&quot;notification&quot;</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-string">&quot;type&quot;</span><span class="syntax-close">]</span> <span class="syntax-operator">==</span> <span class="syntax-string">'m.room.encrypted'</span><span class="syntax-operator">:</span>
        <span class="syntax-symbol">app_id</span> <span class="syntax-operator">=</span> <span class="syntax-symbol">event</span><span class="syntax-open">[</span><span class="syntax-string">&quot;notification&quot;</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-string">&quot;devices&quot;</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-symbol">0</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-string">&quot;app_id&quot;</span><span class="syntax-close">]</span>
        <span class="syntax-symbol">push_data</span><span class="syntax-open">[</span><span class="syntax-string">&quot;push_way&quot;</span><span class="syntax-close">]</span><span class="syntax-operator">,</span> <span class="syntax-symbol">push_data</span><span class="syntax-open">[</span><span class="syntax-string">&quot;push_token&quot;</span><span class="syntax-close">]</span> <span class="syntax-operator">=</span> <span class="syntax-symbol">event</span><span class="syntax-open">[</span><span class="syntax-string">&quot;notification&quot;</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-string">&quot;devices&quot;</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-symbol">0</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-string">&quot;pushkey&quot;</span><span class="syntax-close">]</span><span class="syntax-operator">.</span><span class="syntax-symbol">split</span><span class="syntax-open">(</span><span class="syntax-string">'-'</span><span class="syntax-close">)</span>
        <span class="syntax-symbol">push_data</span><span class="syntax-open">[</span><span class="syntax-string">&quot;sender&quot;</span><span class="syntax-close">]</span> <span class="syntax-operator">=</span> <span class="syntax-symbol">event</span><span class="syntax-open">[</span><span class="syntax-string">&quot;notification&quot;</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-string">&quot;sender_display_name&quot;</span><span class="syntax-close">]</span>

        <span class="syntax-symbol">scheduler</span><span class="syntax-operator">.</span><span class="syntax-symbol">add_job</span><span class="syntax-open">(</span>
            <span class="syntax-symbol">func</span><span class="syntax-operator">=</span><span class="syntax-symbol">push_notification</span><span class="syntax-operator">,</span>
            <span class="syntax-symbol">args</span><span class="syntax-operator">=</span><span class="syntax-open">(</span><span class="syntax-symbol">push_data</span><span class="syntax-operator">,</span><span class="syntax-close">)</span><span class="syntax-operator">,</span>
            <span class="syntax-comment"># trigger=&quot;date&quot;,
</span>            <span class="syntax-symbol">next_run_time</span><span class="syntax-operator">=</span><span class="syntax-symbol">datetime</span><span class="syntax-operator">.</span><span class="syntax-symbol">datetime</span><span class="syntax-operator">.</span><span class="syntax-symbol">now</span><span class="syntax-open">(</span><span class="syntax-close">)</span> <span class="syntax-operator">+</span> <span class="syntax-symbol">datetime</span><span class="syntax-operator">.</span><span class="syntax-symbol">timedelta</span><span class="syntax-open">(</span><span class="syntax-symbol">seconds</span><span class="syntax-operator">=</span><span class="syntax-symbol">25</span><span class="syntax-close">)</span><span class="syntax-operator">,</span>
            <span class="syntax-keyword">id</span><span class="syntax-operator">=</span><span class="syntax-symbol">app_id</span><span class="syntax-operator">,</span>
            <span class="syntax-symbol">replace_existing</span><span class="syntax-operator">=</span><span class="syntax-special">True</span><span class="syntax-operator">,</span>
        <span class="syntax-close">)</span>

        <span class="syntax-keyword">print</span><span class="syntax-open">(</span><span class="syntax-string">'✅add push job!'</span><span class="syntax-close">)</span>

    <span class="syntax-special">if</span> <span class="syntax-symbol">event</span><span class="syntax-open">[</span><span class="syntax-string">&quot;notification&quot;</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-string">&quot;type&quot;</span><span class="syntax-close">]</span> <span class="syntax-operator">==</span> <span class="syntax-special">None</span> <span class="syntax-special">and</span> <span class="syntax-symbol">event</span><span class="syntax-open">[</span><span class="syntax-string">&quot;notification&quot;</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-string">&quot;id&quot;</span><span class="syntax-close">]</span> <span class="syntax-operator">==</span> <span class="syntax-string">''</span><span class="syntax-operator">:</span>
        <span class="syntax-symbol">app_id</span> <span class="syntax-operator">=</span> <span class="syntax-symbol">event</span><span class="syntax-open">[</span><span class="syntax-string">&quot;notification&quot;</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-string">&quot;devices&quot;</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-symbol">0</span><span class="syntax-close">]</span><span class="syntax-open">[</span><span class="syntax-string">&quot;app_id&quot;</span><span class="syntax-close">]</span>
        <span class="syntax-special">try</span><span class="syntax-operator">:</span>
            <span class="syntax-symbol">scheduler</span><span class="syntax-operator">.</span><span class="syntax-symbol">remove_job</span><span class="syntax-open">(</span><span class="syntax-keyword">id</span><span class="syntax-operator">=</span><span class="syntax-symbol">app_id</span><span class="syntax-close">)</span>
        <span class="syntax-special">except</span><span class="syntax-operator">:</span>
            <span class="syntax-special">pass</span>
        <span class="syntax-keyword">print</span><span class="syntax-open">(</span><span class="syntax-string">'✅remove push!'</span><span class="syntax-close">)</span>

    <span class="syntax-special">return</span> <span class="syntax-symbol">jsonify</span><span class="syntax-open">(</span><span class="syntax-symbol">success</span><span class="syntax-operator">=</span><span class="syntax-special">True</span><span class="syntax-close">)</span></code></pre><p>然后用命令 <code>FLASK_ENV=development FLASK_RUN_PORT=4567 FLASK_APP=webhook.py flask run</code> 就可启用。再然后再用 <code>Nginx</code> 反代一下 <code>4567</code> 端口就行了，因为 <code>Synapse</code> 默认禁止本机访问，为了规范一点就另外开个站点接收请求吧……</p><p>基本逻辑就是接收 <code>JSON</code> 拿到发送者名称和推送令牌，判断是哪项服务，然后等待三十秒推送到对应的应用令牌上去，期间要是判断用户已经阅读了消息，就移除推送作业。</p><p>到此无意外的话，应该就能正常推送了，麻烦……希望以后能够有更友好便捷的方式吧。</p><h1 id="参考">参考</h1><ol><li><a href="https://blog.mjyai.com/2021/02/24/raspberry-pi-gotify/" class="external_link">在树莓派上部署消息推送软件Gotify</a></li></ol></div></div></main><div class="pagination"><a class="btn" href="/2021/12/二一年十二月份梦记/">← 上一页</a><a class="btn" href="/"> 主页 </a><a class="btn" href="/2021/11/二一年十一月梦记/">下一页 →</a></div><div class="comment"><blockquote>如不想授权 Giscus 应用，也可以点击下方<strong>左上角数字</strong>直接跳转到 Github Discussions 进行评论。</blockquote><script src="https://giscus.app/client.js" data-repo="SouthFox-D/SouthFox-D.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkyMjg3NDM0MjQ=" data-category="博客评论" data-category-id="DIC_kwDODaJZAM4CA7bf" data-mapping="specific" data-term="2021/11/为Matrix加入推送功能/" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="top" data-theme="dark_dimmed" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async="true"></script></div></div><div class="sidebar"><div class="widget"><h4>公告</h4><p>周刊计划试运行中……</p></div><div class="widget"><h4>链接</h4><ul><li><a href="/friends/">友链</a></li><li><a href="https://www.travellings.cn/train.html">开往</a></li><li><a href="https://foreverblog.cn/go.html">虫洞</a></li><li><a href="/rss2.xml">Rss</a></li><li><a href="https://www.fsf.org/appeal"><img src="/assets/img/6838639.png" alt="FSF appeal" /></a></li></ul></div><div class="widget"><h4>目录</h4><ul><li><a href="#Gotify">Gotify</a></li><li><a href="#下载">下载</a></li><li><a href="#Nginx反代">Nginx 反代</a></li><li><a href="#设置服务">设置服务</a></li><li><a href="#设置推送">设置推送</a></li><li><a href="#接收推送">接收推送</a></li><li><a href="#参考">参考</a></li></ul></div><div class="widget"><h4>标签</h4><ul><li><a href="/tags/技术">技术</a></li><li><a href="/tags/Matrix">Matrix</a></li></ul></div></div></div><footer class="footer"><div class="copyright"><div><p>© SouthFox 2025 ,Font by <a href="https://github.com/SolidZORO/zpix-pixel-font">Zpix</a></p></div><div><p>Power by <a href="https://dthompson.us/projects/haunt.html">haunt</a> ,source can be found <a href="https://git.southfox.me/southfox/blog">here</a></p></div></div></footer></body></html>