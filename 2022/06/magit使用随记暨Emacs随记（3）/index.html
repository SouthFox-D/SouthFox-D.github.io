<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><meta property="og:title" content="Magit使用随记暨Emacs随记（3） — 狐狸反走矣" /><meta property="og:site_name" content="狐狸反走矣" /><meta property="og:image" content="https://blog.southfox.me/favicon.png" /><meta name="fediverse:creator" content="SouthFox@foxsay.southfox.me" /><title>Magit使用随记暨Emacs随记（3） — 狐狸反走矣</title><link rel="me" href="https://foxsay.southfox.me/@SouthFox" /><link rel="me" href="https://codeberg.org/southfox" /><script src="/assets/js/lips.min.js"></script><link rel="stylesheet" href="/assets/css/main.css" /><script type="text/x-scheme">(let ((font (or (localStorage.getItem "font") "zpix")) (font-select (document.getElementById "font-select"))) (define (string=? a b) (== (a.cmp b) 0)) (define (loop-set options value) (let loop ((i 0)) (if (> i (- (length options) 1)) i (let ((option (get options i))) (if (string=? option.value value) (option.setAttribute "selected" #t) (loop (+ 1 i))))))) (define (set-font font-name) (localStorage.setItem "font" font-name) (document.documentElement.setAttribute "data-font" font-name) (if font-select (loop-set font-select.options font-name))) (font-select.addEventListener "change" (lambda (event) (set-font event.target.value))) (set-font font))</script><link rel="alternative" href="/feed.xml" title="狐狸反走矣" type="application/atom+xml" /><link rel="alternative" href="/rss2.xml" title="狐狸反走矣" type="application/rss+xml" /></head><body><nav class="nav"><a href="/" class="brand"><span>狐狸反走矣</span></a><input id="bmenub" type="checkbox" class="show" aria-label="open menu" /><label for="bmenub" class="burger pseudo button">☰</label><div class="menu"><a href="/archives/">归档</a><a href="/tags/">标签</a><a href="/search/">搜索</a><a href="/about/">关于</a></div></nav><div class="container flex"><div class="content"><main data-pagefind-body="true"><div><h2>Magit使用随记暨Emacs随记（3）</h2><h3>by SouthFox</h3><h3 data-pagefind-sort="date">2022-06-08</h3><div><p><code>magit</code> 是个好东西。</p><span id="more"></span><p><code>Magit</code> 是一个 <code>Emacs</code> 的包，将一大堆长又长的 <code>Git</code> 指令封装成了按键操作，对于受够了了在终端下按够了 <code>TAB</code> 键的人来说，是一种解放，无怪 <code>Magit</code> 的评价在整个 <code>Emacs</code> 生态里评价那么好了。</p><h2 id="Git">Git</h2><p><code>Magit</code> 是建立在 <code>Git</code> 上的，意味着要使用得先对 <code>Git</code> 有一定了解，<a href="https://book.douban.com/subject/27133267/" class="external_link">Pro Git</a> 是一本不错的入门书，而且做为一本「开源」书籍，也很容易在网上找到可在线浏览的方式。</p><h3 id="奇怪比喻">奇怪比喻</h3><p><code>Git</code> 的精髓在于它的设计，工作区、暂存区以及版本库，用 <code>Git</code> 进行工作一般如下所示（图出自 Pro Git）。</p><p><img src="https://media.southfox.me/attachment/bafkreidcpqxgpknpmc5nmtjqzulncjwfdauiorlt6lcggxfswjh36rjelq" alt="" /></p><p>用小学生写作业做比喻的话，草稿纸即是工作区，做好相关计算后把结果誊抄到作业本上，作业本既是暂存区（<code>Index</code>、<code>Stage</code>），最后确认无误后即可把作业本放入书包，书包既是版本库了。</p><p><code>Git</code> 的设计给了使用者操作上的灵活，却也让人感到冗长，设置别名可以缓解这种情况，不过还是没有优化到单键操作的 <code>Magit</code> 偷懒偷得多。</p><h2 id="Magit">Magit</h2><h3 id="一般流程">一般流程</h3><p>在 <code>Doom Emacs</code> 下，使用 <code>SPC g g</code> 即可选择一个 <code>Git</code> 仓库（如果已经打开了一个 <code>Git</code> 仓库的的文件即可直接打开当前仓库下的 <code>Magit</code> 界面）打开 <code>Magit</code> 界面。</p><p><img src="https://media.southfox.me/attachment/bafkreiele2ihm55y4rbemvz4dojlnukapibj4zn5isssj2x5huqsq76qdq" alt="" /></p><p>在 <code>Magit</code> 界面下，可以很方便看到工作区发生变动的文件（Unstaged changes），以及已经加入到暂存区的文件（Staged changes）。</p><p><img src="https://media.southfox.me/attachment/bafkreicttv7rkuzq5ishn6x3lix4rwdtkka7dubm5rjh67teehgcbh7nzy" alt="" /></p><p>光标在某个文件上时，按下 <code>TAB</code> 即可展示文件的变动，按下回车即可直接跳转到文件进行编辑，按下 <code>s</code> 即可将文件暂存，对处于暂存区文件按下 <code>u</code> 即可取消暂存（<code>S</code> 和 <code>U</code> 则是应用于全体文件）。忘掉 <code>git add xxx</code> 吧，谁会怀念它？</p><p>确认暂存区的改动后即可进行提交（commit）将其送入版本库了，对应的快捷键是 <code>c</code>，对于很多复杂的 <code>Git</code> 操作附带了很多选项来完成，<code>Magit</code> 把能用的操作都罗列了出来，做到了看菜下饭。</p><p>对于提交（commit） 操作，其里面常用的有：</p><ul><li><code>- s</code> 或 <code>- S</code> 附上签名消息或使用 <code>GPG</code> 进行签名认证。</li><li><code>c</code> 进行 <code>commit</code> 操作，之后会打开一个新区域输入消息，输入完毕后用 <code>C-c C-c</code> 进行确认（<code>C-c C-k</code> 为取消提交）。</li><li><code>a</code> 进行 <code>--amend</code> 操作，即为重新进行提交操作，适用于提交完了才发现漏掉了几个文件没有添加，或者提交信息写错了的情况。</li></ul><p>实际用习惯了之后基本就是无脑操作了，比如使用 <code>p p</code> 快捷键，即可直接推送到默认的分支上，如果要进行其他操作比如推送到其他分支上，那么按一下 <code>p</code> 之后再看信息提示进行操作也不会太难。</p><p>对于更多操作，按下 <code>?</code> 即可进入提示菜单，或是翻阅 <code>Magit</code> 的<a href="https://magit.vc/manual/magit.html" class="external_link">手册</a>了解更多操作。</p><h3 id="从实战到跑路">从实战到跑路</h3><p>现在来说说我拿 <code>Magit</code> 实际干过的事吧，</p><p>首先是要心动，看上了其他分支的功能，打算抄抄作业，那么第一件事就是把对方仓库克隆下来。在 <code>Magit</code> 界面按下 <code>M</code> 即可进入 <code>Remote</code> 界面，按下 <code>a</code> 添加，输入名称以及仓库地址来添加一个 <code>Remote</code> 。</p><p>接着开始检索对方仓库的提交，检出自己需要的提交，按下 <code>l</code> 打开 <code>log</code> 界面，按下 <code>- F</code> 搜索提交消息，之后输入想检索的提交消息，例如 <code>exclusive list</code>，再按下 <code>o</code> ，选择搜索其他（other）分支的历史记录，选择之前添加的 <code>Remote</code> 仓库的分支。</p><p><img src="https://media.southfox.me/attachment/bafkreiduuqcpezsvunsggij4gfahdn53kxiacwewsbmciglk62v44yoane" alt="" /></p><p>可以看到搜索出了相关的三条结果，从最旧的开始合并，将光标移动到最旧的提交，按下 <code>A A</code> 进行一次 <code>cherry-pick</code> 。</p><p><img src="https://media.southfox.me/attachment/bafkreifkslyzgyvcm5zkapevoxkrnkdubh7uwbwwjjpjrkmwur43k4ji7i" alt="" /></p><p>啊啊啊……！一大堆冲突，毕竟这次的提交很老旧了，是三年前的提交，发生变化很正常……</p><p>感叹一句没有银弹，<code>Git</code> 对于冲突也从不僭越，会去自作主张搞定。所以只能自己上了，对于这种老旧的提交，可以前去 <code>GitHub</code> 的那次提交消息里查看改动了哪些文件，再前去最新版本文件下仔细比对最新的样子是什么。当然 <code>Magit</code> 同时也提供了一个命令 <code>magit-log-buffer-file</code>（<code>SPC g L</code>）查看当前文件下有那些提交，</p><p><img src="https://media.southfox.me/attachment/bafkreied5lnnuofc7isxw3ufrg6j7gbs4ptzs27pkuxq54tcicnltl3k5e" alt="检出更改" /></p><p>不过用这种方式查看双方提交记录的话，得先 <code>Stash</code> 修改再切换到对方分支查看历史记录又切换回来，感觉挺麻烦……所以我就先用 <code>GitHub</code> 查看历史了，或许有更快速方便的方法？</p><p>总之，确定该怎样合并后即可进入 <code>Unstaged changes</code> 上的任一文件按下 <code>E</code> 打开 <code>Ediff</code> 选单，再按下 <code>m</code> 解决冲突。</p><p><img src="https://media.southfox.me/attachment/bafkreie5it6wivelcnp63l34epa377lijrksptmodz7nwsb7325n4g4zsq" alt="" /></p><p>进入冲突选单后，用 <code>n</code> 键跳转到下一冲突处（<code>p</code> 为上一个），接着按下 <code>a</code> 或 <code>b</code> 选择保留那一方的修改，这次的提交要结合两者，所以首先选择一方，然后用 <code>SPC w k</code> 将焦点移动到上方文件编辑区进行编辑，编辑完后再用 <code>SPC w j</code> 将焦点移回 <code>Ediff</code> 区。处理完全部冲突后，按下 <code>q</code> 退出，再处理其他文件的冲突。</p><p>处理完全部冲突后，按下 <code>c c</code> 进行一次提交，之后按下 <code>p p</code> 推送到 <code>GitHub</code> 上，祈祷部署能够成功吧！</p><p>如果想要合并的提交不是那么久远的话，可以用 <code>Y</code> 按键对应的 <code>Cherries</code> 操作来检出自己想要的提交，虽然我没用过（</p></div></div></main><div class="pagination"><a class="btn" href="/2022/06/二二年六月梦记/">← 上一页</a><a class="btn" href="/"> 主页 </a><a class="btn" href="/2022/05/我拿Emacs做什么暨Emacs随记（2）/">下一页 →</a></div><div class="comment"><blockquote>如不想授权 Giscus 应用，也可以点击下方<strong>左上角数字</strong>直接跳转到 Github Discussions 进行评论。</blockquote><script src="https://giscus.app/client.js" data-repo="SouthFox-D/SouthFox-D.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkyMjg3NDM0MjQ=" data-category="博客评论" data-category-id="DIC_kwDODaJZAM4CA7bf" data-mapping="specific" data-term="2022/06/magit使用随记暨Emacs随记（3）/" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="top" data-theme="dark_dimmed" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async=""></script></div></div><div class="sidebar"><div class="widget"><h4>链接</h4><ul><li><a href="/friends/">友链</a></li><li><a href="https://www.travellings.cn/train.html">开往</a></li><li><a href="https://foreverblog.cn/go.html">虫洞</a></li><li><a href="/feed.xml">订阅（Atom)</a></li><li><a href="/rss2.xml">订阅（Rss)</a></li><li><a href="https://www.lisperati.com/logo.html"><img src="/assets/img/lisplogo_warning2_128.png" alt="Lisp logo warning" /></a></li><li><a href="https://www.fsf.org/appeal"><img src="/assets/img/6838639.png" alt="FSF appeal" /></a></li></ul><div><a href="https://xn--sr8hvo.ws/previous">←</a><a href="https://xn--sr8hvo.ws">IndieWeb Webring 💍</a><a href="https://xn--sr8hvo.ws/next">→</a></div><div><a href="https://fediring.net/previous?host=blog.southfox.me">←</a><a href="https://fediring.net">Fediring 💍</a><a href="https://fediring.net/next?host=blog.southfox.me">→</a></div></div><div class="widget"><h4>设置</h4><div><label for="font-select">字体设置：</label><select id="font-select"><option value="plain">普通</option><option value="zpix">像素</option></select></div></div><div class="widget"><h4>标签</h4><ul><li><a href="/tag/Emacs">Emacs</a></li><li><a href="/tag/Git">Git</a></li></ul></div><div class="widget"><h4>目录</h4><ul><li><a href="#Git">Git</a></li><li><a href="#奇怪比喻">奇怪比喻</a></li><li><a href="#Magit">Magit</a></li><li><a href="#一般流程">一般流程</a></li><li><a href="#从实战到跑路">从实战到跑路</a></li></ul></div></div></div><footer class="footer"><div class="copyright"><div><p>© SouthFox 2026 ,Font by <a href="https://github.com/SolidZORO/zpix-pixel-font">Zpix</a></p></div><div><p>Power by <a href="https://dthompson.us/projects/haunt.html">haunt</a> ,source can be found <a href="https://git.southfox.me/southfox/blog">here</a></p></div></div></footer></body></html>